Common functionality used by server and client internal implementations. Not exposed to clients.